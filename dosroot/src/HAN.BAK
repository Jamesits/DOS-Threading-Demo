#include "common.h"
#include "han.h"

int disp_hz(int left,int top,unsigned char byte1,unsigned  char byte2,int color)
{
    FILE *hzkfile;
    unsigned char buf[32];
    unsigned char mark;
    long p;
    int i,j,y;
    int quma,weima;
    hzkfile=fopen("HZK16","rb");
    if((hzkfile==NULL))
    {
	outtextxy(10,10,"Cannot open hzk file! Press any key to quit...\n");
    }
    
    if((byte1>=0xa1&&byte1<=0xfe)&&(byte2>=0xa1&&byte2<=0xfe))
    {
	quma=byte1-0xa0;
	weima=byte2-0xa0;
	p=(quma-1)*94+weima-1;
	p*=32;
	fseek(hzkfile,(long)p,SEEK_SET);
	fread(buf,sizeof(unsigned char),32,hzkfile);
	fclose(hzkfile);
	for(i=0,y=top;i<31;i+=2,y++)
		for(mark=0x80,j=0;mark>0;mark=mark>>1,j++)
		{
			if((buf[i]&mark)!=0)putpixel(left+j,y,color);
			if((buf[i+1]&mark)!=0)putpixel(left+j+8,y,color);
		}
    }
    fclose(hzkfile);
    return 1;
}

int OutTextxy(int x,int y,char *p,int color)
{
    int oldcolor;
    int disp_hz(int left,int top,unsigned char byte1,unsigned char byte2,int color);
    oldcolor=getcolor();
    setcolor(color);
    while(*p)
    {
	if(((unsigned char)*p>=0xa1&&(unsigned char)*p<=0xfe)
	     &&((unsigned char)*(p+1)>=0xa1&&(unsigned char)*(p+1)<=0xfe))
	{
		if((x+16-1)>getmaxx()||(y+16-1)>getmaxy())return 0;
		disp_hz(x,y,*p,*(p+1),color);
		p+=2;
		x+=16+2;
		moveto(x,y);
	}
	else
	{
		char q[2];
		moveto(x,y);
		*q=*p;
		*(q+1)='\0';
		settextstyle(TRIPLEx_FONT,HORIZ_DIR,0);
		setusercharsize(1,1,3,2);
		outtextxy(x,y+4,q);
		x+=8+1;
		p++;
	}
    }
   setcolor(oldcolor);
   return 1;
}
